首先梳理任务流程

#### 服务器
1. 创建socket套接字，绑定一个固定ip和端口供客户端连接
2. epoll监听套接字EPOLLIN（可读事件），等待有客户端的连接，这里做分支处理，确认是新客户端要连接还是已连接客户端发送数据
3. 收到新客户端的连接请求，接受连接，并将其加入epoll监听的的套接字中
4. 对于已连接的客户端发送的数据，开辟一个新线程处理发来的数据，这里做一个命令判断，普通的信息正常显示，对于PASV命令进行处理
5. 接收到PASV命令后，创建一个新线程，并再创建一个socket,使用随机的端口，并将端口信息发送给客户端
6. 确认连接后，开始传输文件

#### 客户端
1. 连接服务器的固定端口
2. 此时可以进行正常的对话传输，这里对传输的内容进行判断，正常数据就发送，遇到命令PASV进入传输文件模式
3. 获取服务器发送过来的新端口，建立数据连接通道
4. 在这里提供命令LIST，STOR,RETR命令，客户端通过LIST获取文件地址，再使用STOR来上传文件

#### 遇到的问题
在客户端建立连接后，只能发一条消息，后服务器自动把客户端关闭，并且在此期间，电脑风扇狂转
>原因：服务器把客户端套接字设置为非阻塞的，recv会不断尝试读取，返回值设为1,并把errno设为EAGAIN，由于未做这方面的检测，程序直接认为发生错误，关闭了客户端，并且一直在while循环中尝试读取，但由于已经关闭了客户端，所以无限循环下去
客户端发送PASV后，服务器发送随机的ip,但客户端接受不到，recv返回值为0
>recv使用的string类来接收发送的字符串，但string使用了reserve来预分配内存，但实际内存还是0,导致接收数据失败
这次是客户端建立连接，然而在发送一条消息后服务器显示错误，直接断开连接，调试发现报错为bad file descriptor
>原因：我把客户端连接的套接字设为类内变量，导致函数间套接字混乱，服务器可能发现了多个对套接字的同时操作，所以关闭